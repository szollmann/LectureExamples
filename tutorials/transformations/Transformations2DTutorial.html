<!DOCTYPE html>
<html lang="en">
	<head>
		<title>2D Transformations</title>
		<meta charset="utf-8">
			<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
				<link rel="stylesheet" href="Transformations2DTutorial/themes/test.min.css" />
				<link rel="stylesheet" href="Transformations2DTutorial/themes/jquery.mobile.icons.min.css" />
				<link rel="stylesheet" href="Transformations2DTutorial/jquery/jquery.mobile.structure-1.4.5.min.css" />
				<script src="Transformations2DTutorial/jquery/jquery-1.11.1.min.js"></script>
				<script src="Transformations2DTutorial/jquery/jquery.mobile-1.4.5.min.js"></script>
				
				<style>
					body {
						margin: 0px;
						background-color: #000000;
						overflow: hidden;
					}
				</style>
				</head>
	<body>
		
		<script src="Transformations2DTutorial/three.min.js"></script>
		<script src="Transformations2DTutorial/js/OrbitControls.js"></script>
		<a href="Transformations2DTutorial.html#popupBasic" id="popupbutton" data-rel="popup">Transform 2D</a>
		
		<div data-role="popup" id="popupBasic" data-dismissible="false" data-theme="b" style="z-index: 3000;   position: absolute; padding: 10px 20px 10px 10px;width:360px; background-color: rgba(202, 202, 202, 0.75);background: rgba(202, 202, 202, 0.75);" data-position-to="#popupbutton">
			<a href="Transformations2DTutorial.html#" data-rel="back" class="ui-btn ui-corner-all ui-shadow ui-btn-b ui-icon-delete ui-btn-icon-notext ui-btn-left">Close</a>
			<h3>Transform 2D</h3>
			<h4>Input</h4>
			<div id="main">
				<form>
					<textarea  id="matrix">
[1, 0, 0],
[0, 1, 0],
[0, 0, 1]
						
					</textarea>
					<button type="button" id="applyButton" onclick="applyMatrix()" >Apply Matrix!</button>
					<button type="button" id="resetButton" onclick="resetMatrix()" >Reset Matrix!</button>
					<h4>Output</h4>
					
					<textarea id="completematrix">
						
						
						
						
					</textarea>
				</form>
			</div>
			
		</div>
		


		<script>
			
			var container;
			
			var camera, scene, renderer;
			var controls;
			
			var group;
			
			var targetRotation = 0;
			var targetRotationOnMouseDown = 0;
			
			var mouseX = 0;
			var mouseXOnMouseDown = 0;
			
			var windowHalfX = window.innerWidth / 2;
			var windowHalfY = window.innerHeight / 2;
			var mesh;
			init();
			animate();
			
			function init() {
				
				container = document.createElement( 'div' );
				document.body.appendChild( container );
				
				var info = document.createElement( 'div' );
				info.style.position = 'absolute';
				info.style.top = '10px';
				info.style.width = '100%';
				info.style.textAlign = 'center';
				info.innerHTML = 'Demonstration of 2D transforms';
				container.appendChild( info );
				
				scene = new THREE.Scene();
				
				camera = new THREE.PerspectiveCamera( 50, window.innerWidth / window.innerHeight, 1, 2000 );
				camera.position.set( 0, 0, 30 );
				scene.add( camera );
				
				var light = new THREE.PointLight( 0xffffff, 0.8 );
				camera.add( light );
				
				group = new THREE.Group();
				var axisHelper = new THREE.AxisHelper( 1000);
				group.add( axisHelper );

				group.position.y = 0;
				group.position.z = 0;
				scene.add( group );
				
				
				function addShape( shape, extrudeSettings, color ) {
					
					// flat shape with texture
					// note: default UVs generated by ShapeBufferGemoetry are simply the x- and y-coordinates of the vertices
					
					var geometry = new THREE.ShapeBufferGeometry( shape );
					
					var meshMaterial = new THREE.MeshBasicMaterial({color: 0x7777ff, side: THREE.DoubleSide});
					
					
					mesh = new THREE.Mesh( geometry, meshMaterial);
					mesh.position.set( 0, 0, -0.01  );
					//mesh.rotation.set( rx, ry, rz );
					//mesh.scale.set( s, s, s );
					group.add( mesh );
					
					
				}
				
				
				 
				 // Fish
				 
				 var x = -5.0;
				 var y = 0;
				 
				 /*var fishShape = new THREE.Shape();
				 
				 fishShape.moveTo(x,y);
				 fishShape.quadraticCurveTo(x + 5.0, y - 8.0, x + 9.0, y - 1.0);
				 fishShape.quadraticCurveTo(x + 10.0, y - 1.0, x + 11.5, y - 4.0);
				 fishShape.quadraticCurveTo(x + 11.5, y, x + 11.5, y + 4.0);
				 fishShape.quadraticCurveTo(x + 10.0, y + 1.0, x + 9.0, y + 1.0);
				 fishShape.quadraticCurveTo(x + 5.0, y + 8.0, x, y);
				 
				 
				
				 
				 var extrudeSettings = { amount: 8, bevelEnabled: true, bevelSegments: 2, steps: 2, bevelSize: 1, bevelThickness: 1 };
				 
				 // addShape( shape, color, x, y, z, rx, ry,rz, s );
				 
				 addShape( fishShape,        extrudeSettings, 0x404040 );*/
				var marioShape = new THREE.Shape();

// start at bottom-left
marioShape.moveTo(0, 0);

// body
marioShape.lineTo(0, 8);
marioShape.lineTo(4, 8);
marioShape.lineTo(4, 0);
marioShape.lineTo(0, 0);

// head (on top of body)
marioShape.moveTo(1, 8);
marioShape.lineTo(1, 12);
marioShape.lineTo(5, 12);
marioShape.lineTo(5, 8);
marioShape.lineTo(1, 8);

// little “hat”
marioShape.moveTo(1, 12);
marioShape.lineTo(1, 13.5);
marioShape.lineTo(5.5, 13.5);
marioShape.lineTo(5.5, 12);
marioShape.lineTo(1, 12);

// extrusion settings
var extrudeSettings = { 
    depth: 2,       // use "depth" instead of "amount" in newer Three.js
    bevelEnabled: false 
};

addShape(marioShape, extrudeSettings, 0xff0000);  // red like Mario
				 
				 //
				 
				 renderer = new THREE.WebGLRenderer( { antialias: true } );
				 renderer.setClearColor( 0xf0f0f0 );
				 renderer.setPixelRatio( window.devicePixelRatio );
				 renderer.setSize( window.innerWidth, window.innerHeight );
				 container.appendChild( renderer.domElement );
				
				controls = new THREE.OrbitControls(camera, renderer.domElement);
				// to disable rotation
				// Set to true to disable this control
				controls.noRotate = true;
				window.addEventListener( 'resize', onWindowResize, false );
				 
			}
		
		function PopUp(){
			$( "#popupBasic" ).popup( "open" )
			// to disable pan
			controls.noPan= true;
		}
		
		$(document).ready(function(){
						  setTimeout(function(){
									 PopUp()
									 },1000); // 5000 to load it after 5 seconds from page load
						  
						  $( "#popupBasic" ).bind({
												  popupafterclose: function(event, ui) { //controls.noPan= false;
												  }
												  });
						  });
		
		function onWindowResize() {
			
			windowHalfX = window.innerWidth / 2;
			windowHalfY = window.innerHeight / 2;
			
			camera.aspect = window.innerWidth / window.innerHeight;
			camera.updateProjectionMatrix();
			
			renderer.setSize( window.innerWidth, window.innerHeight );
			
		}
		function applyMatrix() {
			var inputMat = "[ " + $('#matrix').val() + " ]";
			
			if(IsJsonStringValid(inputMat)){
				m1 = JSON.parse( inputMat);
				if(m1.length==3&&m1[0].length==3){
				// m1 = JSON.parse($('#matrix').val());
				var m = new THREE.Matrix4();
				
				/*
				 a b 0 c
				 d e 0 f
				 0 0 0 0
				 g h 0 i
				 */
				m.set(m1[0][0],m1[0][1],0,m1[0][2],
					  m1[1][0],m1[1][1],0,m1[1][2],
					  0,0,1,0,
					  m1[2][0],m1[2][1],0,m1[2][2]);
					  mesh.applyMatrix( m);
					  var completemat =mesh.matrix.elements;
					  printMatrix(completemat);
					  console.log( m1);
				}
				else{
					alert("wrong matrix format");
				}
			}
			else{
				alert("wrong matrix format");
			}
		}
		function resetMatrix() {
			
			mesh.position.set( 0, 0, 0 );
			mesh.rotation.set( 0, 0, 0 );
			mesh.scale.set( 1, 1, 1 );
			mesh.updateMatrix();
			
			var completemat =mesh.matrix.elements;
			printMatrix(completemat);
		
		}
		
		function IsJsonStringValid(str) {
			var maxLen = 1000;
			if (maxLen && str.length > maxLen)
				return false;
			else{
				try {
					JSON.parse(str);
				} catch (e) {
					return false;
				}
				return true;
			}
		}
		
		function printMatrix(completemat){
			var message ="";
			
				message+=completemat[0].toFixed(4) + ", " + completemat[4].toFixed(4) + ", " +completemat[12].toFixed(4) + "\n";
				message+=completemat[1].toFixed(4) + ", " + completemat[5].toFixed(4) + ", " +completemat[13].toFixed(4) + "\n";
				message+=completemat[3].toFixed(4) + ", " + completemat[7].toFixed(4) + ", " +completemat[15].toFixed(4)+ "\n";



			document.getElementById('completematrix').value = message;
		}
		//
		
		
		//
		
		function animate() {
			
			requestAnimationFrame( animate );
			
			render();
		
			
		}
		
		function render() {
			controls.update();
			//group.rotation.y += ( targetRotation - group.rotation.y ) * 0.05;
			renderer.render( scene, camera );
			
		}
		
			</script>
		
	</body>
</html>

